extends ../layouts/default

block head
  meta(property="og:title"        content="League Teams")
  meta(property="og:url"          content="http://www.sflultimate.com/stats")
  meta(property="og:description"  content="Find out the leaderboard.")

block content
  .container(ng-app='StatsApp')
    h1 Spring League Stats
    section.team-list(ng-controller='StatsViewController')
      table.table.stats.table-bordered
        thead
          th Team Color
          th First Name
          th Last Name
          th Assists
          th Scores
          th Defenses
          th Overall
        tbody
          tr(ng-repeat="player in players | orderBy:'-Overall'" ng-class="player['Team Color'].toLowerCase()")
            td {{player["Team Color"]}}
            td {{player["First Name"]}}
            td {{player["Last Name"]}}
            td {{player["Assists"]}}
            td {{player["Scores"]}}
            td {{player["Defenses"]}}
            td {{player["Overall"]}}

block js
  script(src='https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js')
  script.
    angular.module('StatsApp', [])
      .controller("StatsViewController",function ($http, $scope) {

      var query = $http.get("/stats.csv");

      query.success(function (data) {

        var rows    = data.split("\n");
        var headers = rows.splice(0,1)[0].split(",");

        rows = rows.map(function (row) {
          row   = row.split(",");
          var o = {
            Assists: 0,
            Scores: 0,
            Defenses: 0
          };

          row.forEach(function (cell, i) {

            var column = headers[i];
            
            if (column) {

              var cellNum = parseInt(cell) || 0;

              if (column.indexOf("Assists") > -1) {
                o.Assists  += cellNum;
              }

              if (column.indexOf('Scores') > -1) {
                o.Scores   += cellNum;
              }

              if (column.indexOf('Defenses') > -1) {
                o.Defenses += cellNum;
              }

              o[column] = cell;
            }

          });

          o.Overall = o.Assists + o.Scores + o.Defenses

          return o;
        });

        $scope.players = rows;
        console.log(rows);
      });

      query.error(function (e) {
        alert("Error connecting to database.");
      })
    });